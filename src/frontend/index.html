<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style type="text/css">
    .preview {
      background:#888888;
      width:550px;
      height:auto;
      text-align:center;
    }
    .preview img{
      height:320px;
      order:1;
      vertical-align : middle;
    }    
  </style>

  <!-- api gateway generated sdk -->
    <script src="./sdk/lib/axios/dist/axios.standalone.js"></script>
    <script src="./sdk/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script src="./sdk/lib/CryptoJS/rollups/sha256.js"></script>
    <script src="./sdk/lib/CryptoJS/components/hmac.js"></script>
    <script src="./sdk/lib/CryptoJS/components/enc-base64.js"></script>
    <script src="./sdk/lib/url-template/url-template.js"></script>
    <script src="./sdk/lib/apiGatewayCore/sigV4Client.js"></script>
    <script src="./sdk/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script src="./sdk/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script src="./sdk/lib/apiGatewayCore/utils.js"></script>

    <script src="./sdk/apigClient.js"></script>

    <script src="./aws-sdk.min.js"></script>
</head>

<body>

<h1>Upload S3 Test</h1>
<span style='font-size:100px;'>&#128051;</span>

<div>
Textï¼š<input id="text_input" type="text" onkeydown="search(this)">
</div>

<form method="post" enctype="multipart/form-data">
  <div>
    <input type="file" id="image_uploads" name="image_uploads" accept=".jpg, .jpeg, .png"   style="position:absolute;height:320px;width:550px;">
  </div>
  <div class="preview" style="float:left;background:#cccccc;height:320px;width:550px;text-align:center;z-index:1;"><p style="line-height: 300px;">No image</p></div>
</form>

<script>
  var sdk = apigClientFactory.newClient({});

  var input = document.getElementById('image_uploads');  
  var preview = document.querySelector('.preview');

  input.style.opacity = 0;
  input.addEventListener('change', updateImageDisplay);function updateImageDisplay() {
    while(preview.firstChild) {
      preview.removeChild(preview.firstChild);
    }

    if(input.files.length === 0) {
      var para = document.createElement('p');
      para.textContent = 'Please Select a file';
      para.style="line-height: 300px;";
      preview.appendChild(para);
    } 
    else {
      var para = document.createElement('p');
      var image = document.createElement('img');
      image.src = window.URL.createObjectURL(input.files[0]);
      // image.src = "https://www.w3schools.com/images/w3schools_green.jpg";
      preview.appendChild(image);
      preview.appendChild(para);
    }
  }

  function search(ele) {
    if(event.key === 'Enter') {
        console.log(ele.value)
        alert(ele.value);
        
        h = sdk.chatbotPost({}, {
          messages: [{
            type: 'unstructured',
            unstructured: {
              text: "??"
            }
          }]
        }, {}).then((response) => {
        console.log(response);
        var data = response.data;

        var str = data.body

        /*insertResponseMessage(str.substring(1,str.length-1));*/
        //insertResponseMessage(response.data.body.messages[0].content);
        
        /*
        if (data.messages && data.messages.length > 0) {
          console.log('received ' + data.messages.length + ' messages');

          var messages = data.messages;

          for (var message of messages) {
            if (message.type === 'unstructured') {
              insertResponseMessage(message.unstructured.text);
            } else if (message.type === 'structured' && message.structured.type === 'product') {
              var html = '';

              insertResponseMessage(message.structured.text);

              setTimeout(function() {
                html = '<img src="' + message.structured.payload.imageUrl + '" witdth="200" height="240" class="thumbnail" /><b>' +
                  message.structured.payload.name + '<br>$' +
                  message.structured.payload.price +
                  '</b><br><a href="#" onclick="' + message.structured.payload.clickAction + '()">' +
                  message.structured.payload.buttonLabel + '</a>';
                insertResponseMessage(html);
              }, 1100);
            } else {
              console.log('not implemented');
            }
          }
        } else {
          insertResponseMessage('Oops, something went wrong? Please try again.');
        }
        */
      })
      .catch((error) => {
        console.log('an error occurred', error);
        //insertResponseMessage('Oops, something went wrong. Please try again?');
      });;

        console.log(h) 

        alert("POST");      

    }
  }
</script>

</body>
</html>